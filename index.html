<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fossil Hunter - 3D Archaeology Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #gameCanvas {
            display: block;
            cursor: crosshair;
        }
        
        .fossil-popup {
            animation: fossilFound 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes fossilFound {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.3) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes levelUp {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .level-up-anim {
            animation: levelUp 0.6s ease-in-out;
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }
        
        .pulse-btn {
            animation: pulse 2s infinite;
        }
        
        .panel-shimmer {
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.1) 50%, 
                rgba(255,255,255,0) 100%);
            background-size: 1000px 100%;
            animation: shimmer 3s infinite;
        }
        
        .glass-panel {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.75);
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .glow-text {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5),
                         0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .mobile-compact {
                font-size: 0.875rem;
            }
            
            .mobile-hidden {
                display: none;
            }
            
            .glass-panel {
                background: rgba(0, 0, 0, 0.85);
            }
        }
        
        /* Touch button styles */
        .touch-btn {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transition: transform 0.1s, opacity 0.1s;
        }
        
        .touch-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* Prevent iOS rubber band scrolling */
        html, body {
            position: fixed;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-amber-900 to-amber-700">
    <!-- UI Overlay -->
    <div class="fixed top-0 left-0 w-full z-10 pointer-events-none">
        <div class="p-2 md:p-4 flex justify-between items-start">
            <!-- Left Panel -->
            <div class="glass-panel text-white p-3 md:p-5 rounded-xl pointer-events-auto mobile-compact">
                <h1 class="text-lg md:text-2xl font-bold glow-text text-amber-400 mb-2 md:mb-3">ü¶¥ Fossil Hunter</h1>
                <div class="space-y-1 md:space-y-2 text-xs md:text-sm">
                    <div id="timeline" class="text-sm md:text-lg font-semibold text-green-400 glow-text"></div>
                    <div id="progress" class="text-amber-200 font-medium"></div>
                    <div id="score" class="text-yellow-300 font-bold text-base md:text-lg">Score: 0</div>
                </div>
            </div>
            
            <!-- Right Panel - Hidden on mobile by default -->
            <div class="glass-panel text-white p-3 md:p-5 rounded-xl pointer-events-auto max-w-xs mobile-hidden md:block">
                <h2 class="text-base md:text-lg font-bold text-amber-400 mb-2 md:mb-3 glow-text">üìú Timeline Info</h2>
                <div id="timelineInfo" class="text-xs md:text-sm leading-relaxed"></div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Info Toggle Button -->
    <div class="fixed top-2 right-2 z-20 md:hidden">
        <button id="infoToggle" class="glass-panel text-white p-3 rounded-full touch-btn pointer-events-auto">
            <span class="text-xl">‚ÑπÔ∏è</span>
        </button>
    </div>
    
    <!-- Mobile Info Panel (toggleable) -->
    <div id="mobileInfo" class="fixed top-14 right-2 z-15 hidden md:hidden">
        <div class="glass-panel text-white p-3 rounded-xl max-w-xs pointer-events-auto">
            <h2 class="text-sm font-bold text-amber-400 mb-2 glow-text">üìú Timeline Info</h2>
            <div id="mobileTimelineInfo" class="text-xs leading-relaxed"></div>
        </div>
    </div>
    
    <!-- Bottom Controls -->
    <div class="fixed bottom-0 left-0 w-full z-10 pointer-events-none">
        <!-- Desktop Instructions -->
        <div class="p-4 text-center hidden md:block">
            <div class="glass-panel text-white py-4 px-8 rounded-xl inline-block">
                <p class="text-sm font-medium">üîç <strong class="text-cyan-400">Press E to SCAN</strong> for fossils, then <strong class="text-amber-400">CLICK to DIG</strong>! Find all required fossils to advance to the next timeline.</p>
            </div>
        </div>
        
        <!-- Mobile Controls -->
        <div class="p-3 flex justify-center gap-4 md:hidden pointer-events-auto">
            <button id="scanBtn" class="glass-panel text-white px-8 py-4 rounded-xl touch-btn flex items-center gap-2 pulse-btn">
                <span class="text-2xl">üîç</span>
                <span class="font-bold text-sm">SCAN</span>
            </button>
            <button id="helpBtn" class="glass-panel text-white px-6 py-4 rounded-xl touch-btn">
                <span class="text-2xl">‚ùì</span>
            </button>
        </div>
    </div>
    
    <!-- Mobile Help Modal -->
    <div id="helpModal" class="fixed inset-0 z-30 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="glass-panel text-white p-6 rounded-2xl max-w-sm w-full">
            <h3 class="text-lg font-bold text-amber-400 mb-3 glow-text">How to Play</h3>
            <div class="space-y-2 text-sm">
                <p>1Ô∏è‚É£ Tap the <strong class="text-cyan-400">SCAN</strong> button to reveal fossil locations</p>
                <p>2Ô∏è‚É£ <strong class="text-amber-400">TAP</strong> on glowing spots to dig for fossils</p>
                <p>3Ô∏è‚É£ Keep tapping to dig deeper (3 taps per fossil)</p>
                <p>4Ô∏è‚É£ Find all fossils to advance to the next timeline!</p>
                <p class="pt-2 text-xs text-gray-300">üí° Tip: You can only dig at scanned locations!</p>
            </div>
            <button id="closeHelp" class="mt-4 w-full bg-amber-600 py-2 rounded-lg font-bold touch-btn">Got it!</button>
        </div>
    </div>
    
    <!-- Fossil Found Notification -->
    <div id="notification" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none hidden">
        <div class="glass-panel border-2 border-green-400 text-white px-6 md:px-10 py-4 md:py-6 rounded-2xl shadow-2xl text-center fossil-popup">
            <div class="text-4xl md:text-6xl mb-2 md:mb-3">ü¶¥</div>
            <div id="fossilName" class="text-lg md:text-2xl font-bold"></div>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 z-40 bg-black flex items-center justify-center">
        <div class="text-center text-white">
            <div class="text-6xl mb-4 animate-bounce">ü¶¥</div>
            <h2 class="text-2xl font-bold glow-text text-amber-400">Loading Fossil Hunter...</h2>
            <p class="text-sm mt-2 text-gray-300">Preparing your archaeological adventure</p>
        </div>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Mobile detection
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth < 768;
        
        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        
        // Game state
        let score = 0;
        let currentTimelineIndex = 0;
        let scanRadius = isMobile ? 100 : 150;
        let scanPulse = 0;
        let isScanning = false;
        let touchX = 0;
        let touchY = 0;
        let mouseX = 0;
        let mouseY = 0;
        
        // Timeline definitions
        const timelines = [
            {
                name: "Cambrian Period",
                period: "541-485 million years ago",
                description: "The Cambrian Explosion - when most major animal groups appeared. Life was primarily in the oceans.",
                required: isMobile ? 4 : 5,
                fossils: [
                    { name: "Trilobite", emoji: "ü¶ê", points: 10 },
                    { name: "Anomalocaris", emoji: "ü¶û", points: 15 },
                    { name: "Hallucigenia", emoji: "ü™±", points: 12 },
                    { name: "Opabinia", emoji: "ü¶ë", points: 13 },
                    { name: "Pikaia", emoji: "üêü", points: 11 }
                ],
                bgColor: ["#1e40af", "#1e3a8a"],
                bgElements: [
                    { type: 'seaweed', emoji: 'üåø', count: isMobile ? 15 : 25, sway: true },
                    { type: 'kelp', emoji: 'ü™∏', count: isMobile ? 8 : 15, sway: true },
                    { type: 'bubble', emoji: '‚óã', count: isMobile ? 20 : 40, float: true },
                    { type: 'coral', emoji: 'ü™∏', count: isMobile ? 6 : 12, static: true },
                    { type: 'jellyfish', emoji: 'ü™º', count: isMobile ? 4 : 8, float: true },
                    { type: 'shell', emoji: 'üêö', count: isMobile ? 5 : 10, static: true },
                    { type: 'starfish', emoji: '‚≠ê', count: isMobile ? 3 : 6, static: true },
                    { type: 'anemone', emoji: 'üå∫', count: isMobile ? 4 : 8, sway: true }
                ]
            },
            {
                name: "Devonian Period",
                period: "419-359 million years ago",
                description: "Age of Fishes - fish dominated the seas, first tetrapods appeared, and plants colonized land.",
                required: isMobile ? 5 : 6,
                fossils: [
                    { name: "Dunkleosteus", emoji: "üêü", points: 20 },
                    { name: "Coelacanth", emoji: "üê†", points: 18 },
                    { name: "Tiktaalik", emoji: "ü¶é", points: 22 },
                    { name: "Placoderm", emoji: "üê°", points: 17 },
                    { name: "Ancient Coral", emoji: "ü™∏", points: 15 },
                    { name: "Ammonite", emoji: "üêö", points: 16 }
                ],
                bgColor: ["#065f46", "#064e3b"],
                bgElements: [
                    { type: 'kelp', emoji: 'üåø', count: isMobile ? 15 : 30, sway: true },
                    { type: 'seaweed', emoji: 'üåæ', count: isMobile ? 10 : 20, sway: true },
                    { type: 'fish', emoji: 'üêü', count: isMobile ? 8 : 15, swim: true },
                    { type: 'fish2', emoji: 'üê†', count: isMobile ? 6 : 12, swim: true },
                    { type: 'rock', emoji: 'ü™®', count: isMobile ? 8 : 15, static: true },
                    { type: 'coral', emoji: 'ü™∏', count: isMobile ? 5 : 10, static: true },
                    { type: 'bubble', emoji: '‚óã', count: isMobile ? 12 : 25, float: true },
                    { type: 'crab', emoji: 'ü¶Ä', count: isMobile ? 3 : 5, static: true }
                ]
            },
            {
                name: "Carboniferous Period",
                period: "359-299 million years ago",
                description: "Giant insects and amphibians ruled. Vast swamp forests formed today's coal deposits.",
                required: isMobile ? 5 : 7,
                fossils: [
                    { name: "Meganeura (Giant Dragonfly)", emoji: "ü¶ó", points: 25 },
                    { name: "Arthropleura", emoji: "üêõ", points: 28 },
                    { name: "Eryops", emoji: "üê∏", points: 24 },
                    { name: "Giant Scorpion", emoji: "ü¶Ç", points: 26 },
                    { name: "Seed Fern", emoji: "üåø", points: 20 },
                    { name: "Lepidodendron", emoji: "üå≤", points: 22 },
                    { name: "Giant Millipede", emoji: "ü™≤", points: 23 }
                ],
                bgColor: ["#365314", "#3f6212"],
                bgElements: [
                    { type: 'fern', emoji: 'üåø', count: isMobile ? 18 : 35, sway: true },
                    { type: 'tree', emoji: 'üå≤', count: isMobile ? 8 : 15, static: true },
                    { type: 'palm', emoji: 'üå¥', count: isMobile ? 5 : 10, sway: true },
                    { type: 'dragonfly', emoji: 'ü¶ü', count: isMobile ? 10 : 20, fly: true },
                    { type: 'fly', emoji: 'ü™∞', count: isMobile ? 8 : 15, fly: true },
                    { type: 'mushroom', emoji: 'üçÑ', count: isMobile ? 6 : 12, static: true },
                    { type: 'leaf', emoji: 'üçÉ', count: isMobile ? 12 : 25, float: true },
                    { type: 'log', emoji: 'ü™µ', count: isMobile ? 4 : 8, static: true },
                    { type: 'mist', emoji: 'üå´Ô∏è', count: isMobile ? 5 : 10, float: true }
                ]
            },
            {
                name: "Jurassic Period",
                period: "201-145 million years ago",
                description: "Age of Dinosaurs! Giant sauropods, fierce predators, and the first birds appeared.",
                required: isMobile ? 6 : 8,
                fossils: [
                    { name: "Allosaurus", emoji: "ü¶ñ", points: 35 },
                    { name: "Stegosaurus", emoji: "ü¶ï", points: 32 },
                    { name: "Brachiosaurus", emoji: "ü¶ï", points: 38 },
                    { name: "Archaeopteryx", emoji: "ü¶Ö", points: 40 },
                    { name: "Pterodactyl", emoji: "ü¶á", points: 34 },
                    { name: "Ichthyosaur", emoji: "üêã", points: 33 },
                    { name: "Plesiosaur", emoji: "ü¶ï", points: 36 },
                    { name: "Dilophosaurus", emoji: "ü¶é", points: 31 }
                ],
                bgColor: ["#92400e", "#78350f"],
                bgElements: [
                    { type: 'palm', emoji: 'üå¥', count: isMobile ? 9 : 18, sway: true },
                    { type: 'cycad', emoji: 'üåø', count: isMobile ? 11 : 22, sway: true },
                    { type: 'volcano', emoji: 'üåã', count: isMobile ? 2 : 4, static: true },
                    { type: 'pterosaur', emoji: 'ü¶Ö', count: isMobile ? 6 : 12, fly: true },
                    { type: 'bird', emoji: 'ü¶ú', count: isMobile ? 5 : 10, fly: true },
                    { type: 'rock', emoji: 'ü™®', count: isMobile ? 10 : 20, static: true },
                    { type: 'boulder', emoji: 'üóø', count: isMobile ? 4 : 8, static: true },
                    { type: 'smoke', emoji: 'üí®', count: isMobile ? 3 : 6, float: true },
                    { type: 'fern', emoji: 'üåæ', count: isMobile ? 8 : 15, sway: true }
                ]
            },
            {
                name: "Cretaceous Period",
                period: "145-66 million years ago",
                description: "Final age of dinosaurs. T-Rex, Triceratops, and flowering plants dominated before the mass extinction.",
                required: isMobile ? 6 : 9,
                fossils: [
                    { name: "Tyrannosaurus Rex", emoji: "ü¶ñ", points: 50 },
                    { name: "Triceratops", emoji: "ü¶è", points: 45 },
                    { name: "Velociraptor", emoji: "ü¶ñ", points: 48 },
                    { name: "Spinosaurus", emoji: "ü¶ï", points: 52 },
                    { name: "Ankylosaurus", emoji: "ü¶ï", points: 44 },
                    { name: "Mosasaurus", emoji: "üêä", points: 47 },
                    { name: "Quetzalcoatlus", emoji: "ü¶Ö", points: 49 },
                    { name: "Parasaurolophus", emoji: "ü¶ï", points: 43 },
                    { name: "Flowering Plant", emoji: "üå∫", points: 40 }
                ],
                bgColor: ["#7c2d12", "#991b1b"],
                bgElements: [
                    { type: 'flower', emoji: 'üå∫', count: isMobile ? 10 : 20, sway: true },
                    { type: 'flower2', emoji: 'üå∏', count: isMobile ? 9 : 18, sway: true },
                    { type: 'tree', emoji: 'üå≥', count: isMobile ? 8 : 15, static: true },
                    { type: 'palm', emoji: 'üå¥', count: isMobile ? 6 : 12, sway: true },
                    { type: 'rock', emoji: 'ü™®', count: isMobile ? 10 : 20, static: true },
                    { type: 'boulder', emoji: 'üóø', count: isMobile ? 4 : 8, static: true },
                    { type: 'bird', emoji: 'ü¶Ö', count: isMobile ? 5 : 10, fly: true },
                    { type: 'pterosaur', emoji: 'ü¶ú', count: isMobile ? 4 : 8, fly: true },
                    { type: 'bush', emoji: 'üåø', count: isMobile ? 12 : 25, sway: true },
                    { type: 'grass', emoji: 'üåæ', count: isMobile ? 10 : 20, sway: true }
                ]
            },
            {
                name: "Paleogene Period",
                period: "66-23 million years ago",
                description: "After the dinosaurs - mammals and birds diversified rapidly.",
                required: isMobile ? 7 : 10,
                fossils: [
                    { name: "Smilodon (Saber-tooth)", emoji: "üêÖ", points: 60 },
                    { name: "Mammoth", emoji: "ü¶£", points: 58 },
                    { name: "Giant Ground Sloth", emoji: "ü¶•", points: 55 },
                    { name: "Terror Bird", emoji: "ü¶§", points: 62 },
                    { name: "Basilosaurus", emoji: "üêã", points: 57 },
                    { name: "Andrewsarchus", emoji: "üê∫", points: 59 },
                    { name: "Giant Rhinoceros", emoji: "ü¶è", points: 56 },
                    { name: "Early Horse", emoji: "üê¥", points: 54 },
                    { name: "Dire Wolf", emoji: "üê∫", points: 61 },
                    { name: "Cave Bear", emoji: "üêª", points: 63 }
                ],
                bgColor: ["#4c1d95", "#5b21b6"],
                bgElements: [
                    { type: 'tree', emoji: 'üå≥', count: isMobile ? 6 : 12, sway: true },
                    { type: 'grass', emoji: 'üåæ', count: isMobile ? 10 : 20, sway: true },
                    { type: 'cloud', emoji: '‚òÅÔ∏è', count: isMobile ? 4 : 8, float: true }
                ]
            },
            {
                name: "Industrial Revolution",
                period: "1760-1840 CE",
                description: "The dawn of modern industry - steam engines and factories changed the world.",
                required: isMobile ? 7 : 11,
                fossils: [
                    { name: "Steam Engine Parts", emoji: "‚öôÔ∏è", points: 70 },
                    { name: "Iron Railroad Spike", emoji: "üî©", points: 65 },
                    { name: "Factory Machinery", emoji: "üè≠", points: 75 },
                    { name: "Coal Mining Tools", emoji: "‚õèÔ∏è", points: 68 },
                    { name: "Telegraph Wire", emoji: "üì°", points: 72 },
                    { name: "Textile Loom Part", emoji: "üßµ", points: 66 },
                    { name: "Gas Lamp", emoji: "üí°", points: 64 },
                    { name: "Pocket Watch", emoji: "‚åö", points: 69 },
                    { name: "Printing Press Type", emoji: "üì∞", points: 71 },
                    { name: "Steam Whistle", emoji: "üöÇ", points: 73 },
                    { name: "Iron Anvil", emoji: "üî®", points: 67 }
                ],
                bgColor: ["#374151", "#1f2937"],
                bgElements: [
                    { type: 'smoke', emoji: 'üí®', count: isMobile ? 8 : 15, float: true },
                    { type: 'factory', emoji: 'üè≠', count: isMobile ? 3 : 5, static: true },
                    { type: 'gear', emoji: '‚öôÔ∏è', count: isMobile ? 5 : 10, rotate: true }
                ]
            },
            {
                name: "Digital Age",
                period: "1950-2000 CE",
                description: "The computer revolution - from mainframes to personal computers.",
                required: isMobile ? 8 : 12,
                fossils: [
                    { name: "Vacuum Tube", emoji: "üí°", points: 80 },
                    { name: "Floppy Disk", emoji: "üíæ", points: 85 },
                    { name: "Cassette Tape", emoji: "üìº", points: 78 },
                    { name: "Rotary Phone", emoji: "‚òéÔ∏è", points: 82 },
                    { name: "CRT Monitor", emoji: "üñ•Ô∏è", points: 90 },
                    { name: "Game Cartridge", emoji: "üéÆ", points: 88 },
                    { name: "Mainframe Card", emoji: "üóÉÔ∏è", points: 83 },
                    { name: "Calculator", emoji: "üî¢", points: 79 },
                    { name: "VHS Tape", emoji: "üìπ", points: 81 },
                    { name: "Modem", emoji: "üìû", points: 86 },
                    { name: "CD-ROM", emoji: "üíø", points: 84 },
                    { name: "Keyboard", emoji: "‚å®Ô∏è", points: 87 }
                ],
                bgColor: ["#1e3a8a", "#1e40af"],
                bgElements: [
                    { type: 'pixel', emoji: '‚ñ™Ô∏è', count: isMobile ? 15 : 30, float: true },
                    { type: 'computer', emoji: 'üíª', count: isMobile ? 4 : 8, static: true },
                    { type: 'data', emoji: '01', count: isMobile ? 10 : 20, scroll: true }
                ]
            },
            {
                name: "Near Future",
                period: "2024-2100 CE",
                description: "The age of AI, quantum computing, and space exploration.",
                required: isMobile ? 8 : 13,
                fossils: [
                    { name: "AI Core Chip", emoji: "ü§ñ", points: 100 },
                    { name: "Quantum Processor", emoji: "‚öõÔ∏è", points: 110 },
                    { name: "Neural Interface", emoji: "üß†", points: 105 },
                    { name: "Solar Panel Array", emoji: "‚òÄÔ∏è", points: 95 },
                    { name: "Drone Component", emoji: "üõ∏", points: 98 },
                    { name: "3D Printer Nozzle", emoji: "üñ®Ô∏è", points: 92 },
                    { name: "VR Headset", emoji: "ü•Ω", points: 97 },
                    { name: "Hologram Projector", emoji: "üìΩÔ∏è", points: 103 },
                    { name: "Smart Glass", emoji: "üëì", points: 94 },
                    { name: "Fusion Battery", emoji: "üîã", points: 108 },
                    { name: "Satellite Fragment", emoji: "üõ∞Ô∏è", points: 99 },
                    { name: "Bionic Limb Part", emoji: "ü¶æ", points: 101 },
                    { name: "Nanobot Container", emoji: "‚öóÔ∏è", points: 106 }
                ],
                bgColor: ["#0c4a6e", "#075985"],
                bgElements: [
                    { type: 'drone', emoji: 'üõ∏', count: isMobile ? 5 : 10, fly: true },
                    { type: 'satellite', emoji: 'üõ∞Ô∏è', count: isMobile ? 3 : 6, orbit: true },
                    { type: 'hologram', emoji: '‚ú®', count: isMobile ? 8 : 15, shimmer: true }
                ]
            },
            {
                name: "Space Age",
                period: "2100+ CE",
                description: "Humanity has colonized the solar system.",
                required: isMobile ? 10 : 15,
                fossils: [
                    { name: "Mars Habitat Module", emoji: "üè†", points: 120 },
                    { name: "Asteroid Mining Drill", emoji: "‚õèÔ∏è", points: 125 },
                    { name: "Space Suit Helmet", emoji: "üë®‚ÄçüöÄ", points: 118 },
                    { name: "Rocket Thruster", emoji: "üöÄ", points: 130 },
                    { name: "Solar Sail Fragment", emoji: "‚õµ", points: 115 },
                    { name: "Oxygen Generator", emoji: "üí®", points: 122 },
                    { name: "Hydroponic System", emoji: "üå±", points: 117 },
                    { name: "Communications Array", emoji: "üì°", points: 124 },
                    { name: "Gravity Generator", emoji: "üåÄ", points: 135 },
                    { name: "Plasma Torch", emoji: "üî•", points: 119 },
                    { name: "Cryogenic Pod", emoji: "üßä", points: 128 },
                    { name: "Terraforming Device", emoji: "üåç", points: 140 },
                    { name: "Ion Drive", emoji: "‚ö°", points: 126 },
                    { name: "Space Station Part", emoji: "üõ∞Ô∏è", points: 132 },
                    { name: "Alien Artifact", emoji: "üëΩ", points: 150 }
                ],
                bgColor: ["#0f172a", "#020617"],
                bgElements: [
                    { type: 'star', emoji: '‚ú®', count: isMobile ? 20 : 40, twinkle: true },
                    { type: 'planet', emoji: 'ü™ê', count: isMobile ? 3 : 5, orbit: true },
                    { type: 'rocket', emoji: 'üöÄ', count: isMobile ? 4 : 8, fly: true },
                    { type: 'comet', emoji: '‚òÑÔ∏è', count: isMobile ? 3 : 6, streak: true }
                ]
            }
        ];
        
        let currentTimeline = timelines[currentTimelineIndex];
        let fossilsFound = 0;
        let digSites = [];
        
        // Particle system for digging effect
        let particles = [];
        
        // Background elements
        let bgElements = [];
        let animationTime = 0;
        
        class BackgroundElement {
            constructor(config, index) {
                this.emoji = config.emoji;
                this.type = config.type;
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = (isMobile ? 15 : 20) + Math.random() * (isMobile ? 15 : 20);
                this.offset = index * 0.5;
                this.speed = 0.5 + Math.random() * 1;
                this.opacity = 0.8 + Math.random() * 0.2;
                
                // Movement properties (with default false)
                this.sway = config.sway || false;
                this.float = config.float || false;
                this.swim = config.swim || false;
                this.fly = config.fly || false;
                this.rotate = config.rotate || false;
                this.twinkle = config.twinkle || false;
                this.orbit = config.orbit || false;
                this.shimmer = config.shimmer || false;
                this.scroll = config.scroll || false;
                this.streak = config.streak || false;
                this.static = config.static || false;
                
                if (this.static) {
                    this.y = canvas.height * 0.7 + Math.random() * (canvas.height * 0.25);
                }
            }
            
            update(time) {
                if (this.sway) {
                    this.x += Math.sin(time * 0.001 + this.offset) * 0.5;
                }
                if (this.float) {
                    this.y += Math.sin(time * 0.002 + this.offset) * 0.3 - 0.5;
                    if (this.y < -50) this.y = canvas.height + 50;
                }
                if (this.swim) {
                    this.x += Math.sin(time * 0.003 + this.offset) * 2;
                    this.y += Math.cos(time * 0.002 + this.offset) * 1;
                }
                if (this.fly) {
                    this.x += this.speed;
                    this.y += Math.sin(time * 0.004 + this.offset) * 2;
                    if (this.x > canvas.width + 50) {
                        this.x = -50;
                        this.y = Math.random() * canvas.height * 0.6;
                    }
                }
                if (this.orbit) {
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const radius = (isMobile ? 100 : 200) + this.offset * (isMobile ? 50 : 100);
                    this.x = centerX + Math.cos(time * 0.0005 + this.offset) * radius;
                    this.y = centerY + Math.sin(time * 0.0005 + this.offset) * radius * 0.5;
                }
                if (this.scroll) {
                    this.y += this.speed;
                    if (this.y > canvas.height + 50) this.y = -50;
                }
                if (this.streak) {
                    this.x -= this.speed * 3;
                    this.y += this.speed * 2;
                    if (this.x < -100 || this.y > canvas.height + 100) {
                        this.x = canvas.width + 50;
                        this.y = Math.random() * canvas.height * 0.5;
                    }
                }
            }
            
            draw(time) {
                let alpha = this.opacity;
                if (this.twinkle) {
                    alpha = this.opacity * (0.5 + Math.sin(time * 0.003 + this.offset) * 0.5);
                }
                if (this.shimmer) {
                    alpha = this.opacity * (0.6 + Math.sin(time * 0.005 + this.offset) * 0.4);
                }
                
                ctx.globalAlpha = alpha;
                ctx.font = `${this.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (this.rotate) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(time * 0.001 + this.offset);
                    ctx.fillText(this.emoji, 0, 0);
                    ctx.restore();
                } else {
                    ctx.fillText(this.emoji, this.x, this.y);
                }
                
                ctx.globalAlpha = 1;
            }
        }
        
        function initBackgroundElements() {
            bgElements = [];
            if (!currentTimeline.bgElements) return;
            
            currentTimeline.bgElements.forEach(config => {
                for (let i = 0; i < config.count; i++) {
                    bgElements.push(new BackgroundElement(config, i));
                }
            });
        }
        
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8 - 2;
                this.life = 1;
                this.size = Math.random() * 4 + 2;
                this.color = `hsl(${30 + Math.random() * 30}, 70%, ${40 + Math.random() * 20}%)`;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.3; // gravity
                this.life -= 0.02;
            }
            
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
                ctx.globalAlpha = 1;
            }
        }
        
        class DigSite {
            constructor(x, y, fossil) {
                this.x = x;
                this.y = y;
                this.fossil = fossil;
                this.depth = 0;
                this.maxDepth = 3;
                this.size = isMobile ? 35 : 40;
                this.discovered = false;
                this.scanned = false;
                this.scanAlpha = 0;
            }
            
            dig() {
                this.depth++;
                if (this.depth >= this.maxDepth && !this.discovered) {
                    this.discovered = true;
                    return true;
                }
                return false;
            }
            
            draw() {
                if (this.discovered) return;
                
                // Only draw if scanned
                if (!this.scanned) return;
                
                // Fade in scanned sites
                if (this.scanAlpha < 1) {
                    this.scanAlpha = Math.min(1, this.scanAlpha + 0.05);
                }
                
                // Use different colors for Jurassic Period (index 3)
                let baseColor, ringColor1, ringColor2;
                if (currentTimelineIndex === 3) {
                    // Bright orange/gold for Jurassic Period
                    baseColor = [255, 140, 0]; // Orange
                    ringColor1 = [255, 185, 0]; // Golden
                    ringColor2 = [255, 215, 0]; // Bright gold
                } else {
                    // Default brown colors
                    baseColor = [139, 69, 19];
                    ringColor1 = [205, 133, 63];
                    ringColor2 = [210, 180, 140];
                }
                
                // Draw outer glow
                const glowGradient = ctx.createRadialGradient(this.x, this.y, this.size * 0.5, this.x, this.y, this.size * 1.5);
                glowGradient.addColorStop(0, `rgba(${baseColor[0]}, ${baseColor[1]}, ${baseColor[2]}, ${0.4 * this.scanAlpha})`);
                glowGradient.addColorStop(1, `rgba(${baseColor[0]}, ${baseColor[1]}, ${baseColor[2]}, 0)`);
                ctx.fillStyle = glowGradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw dig site with radial gradient
                const siteGradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
                const alpha = (0.5 + (this.depth / this.maxDepth) * 0.5) * this.scanAlpha;
                siteGradient.addColorStop(0, `rgba(${baseColor[0] + 30}, ${baseColor[1] + 30}, ${baseColor[2] + 30}, ${alpha})`);
                siteGradient.addColorStop(0.7, `rgba(${baseColor[0]}, ${baseColor[1]}, ${baseColor[2]}, ${alpha})`);
                siteGradient.addColorStop(1, `rgba(${Math.max(0, baseColor[0] - 40)}, ${Math.max(0, baseColor[1] - 40)}, ${Math.max(0, baseColor[2] - 40)}, ${alpha})`);
                ctx.fillStyle = siteGradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Add outline
                ctx.strokeStyle = `rgba(${ringColor2[0]}, ${ringColor2[1]}, ${ringColor2[2]}, ${0.6 * this.scanAlpha})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.stroke();
                
                // Depth rings with glow
                if (this.depth > 0) {
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = `rgba(${ringColor1[0]}, ${ringColor1[1]}, ${ringColor1[2]}, 0.5)`;
                    ctx.strokeStyle = `rgba(${ringColor1[0]}, ${ringColor1[1]}, ${ringColor1[2]}, ${(this.depth / this.maxDepth) * this.scanAlpha})`;
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 0.7, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.shadowBlur = 0;
                }
                
                if (this.depth > 1) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = `rgba(${ringColor2[0]}, ${ringColor2[1]}, ${ringColor2[2]}, 0.8)`;
                    ctx.strokeStyle = `rgba(${ringColor2[0]}, ${ringColor2[1]}, ${ringColor2[2]}, ${(this.depth / this.maxDepth) * this.scanAlpha})`;
                    ctx.lineWidth = 5;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size * 0.4, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.shadowBlur = 0;
                }
            }
        }
        
        function initDigSites() {
            digSites = [];
            const fossils = [...currentTimeline.fossils];
            
            // Shuffle and pick required number of fossils
            for (let i = fossils.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [fossils[i], fossils[j]] = [fossils[j], fossils[i]];
            }
            
            // Define safe zones (avoiding UI panels)
            const leftPanelWidth = isMobile ? 200 : 350; // Left panel area
            const rightPanelWidth = isMobile ? 100 : 400; // Right panel area (smaller on mobile)
            const topPanelHeight = isMobile ? 120 : 200; // Top panel area
            const bottomPanelHeight = isMobile ? 100 : 150; // Bottom control area
            const margin = isMobile ? 40 : 60; // Extra margin for dig site size
            
            for (let i = 0; i < currentTimeline.required; i++) {
                let x, y;
                let validPosition = false;
                
                // Keep trying until we find a valid position
                while (!validPosition) {
                    x = Math.random() * (canvas.width - (isMobile ? 100 : 200)) + (isMobile ? 50 : 100);
                    y = Math.random() * (canvas.height - (isMobile ? 200 : 300)) + (isMobile ? 100 : 150);
                    
                    // Check if position is NOT in top-left panel
                    const notInTopLeft = !(x < leftPanelWidth + margin && y < topPanelHeight + margin);
                    
                    // Check if position is NOT in top-right panel (info button area on mobile)
                    const notInTopRight = !(x > canvas.width - rightPanelWidth - margin && y < topPanelHeight + margin);
                    
                    // Check if position is NOT in bottom control area
                    const notInBottom = y < canvas.height - bottomPanelHeight - margin;
                    
                    validPosition = notInTopLeft && notInTopRight && notInBottom;
                }
                
                digSites.push(new DigSite(x, y, fossils[i % fossils.length]));
            }
        }
        
        function showNotification(fossil) {
            const notification = document.getElementById('notification');
            const fossilName = document.getElementById('fossilName');
            
            fossilName.innerHTML = `${fossil.emoji}<br>${fossil.name}<br>+${fossil.points} points`;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 2000);
        }
        
        function updateUI() {
            document.getElementById('timeline').textContent = `Timeline: ${currentTimeline.name}`;
            document.getElementById('progress').textContent = `Fossils Found: ${fossilsFound}/${currentTimeline.required}`;
            document.getElementById('score').textContent = `Score: ${score}`;
            
            // Update both desktop and mobile timeline info
            const infoText = `
                <strong>${currentTimeline.period}</strong><br>
                ${currentTimeline.description}
            `;
            document.getElementById('timelineInfo').innerHTML = infoText;
            
            if (isMobile) {
                document.getElementById('mobileTimelineInfo').innerHTML = infoText;
            }
        }
        
        function nextTimeline() {
            currentTimelineIndex++;
            if (currentTimelineIndex >= timelines.length) {
                // Game won!
                alert(`üéâ Congratulations! You've explored all time periods!\n\nFinal Score: ${score}\n\nYou're a master archaeologist and time traveler!`);
                currentTimelineIndex = 0;
                score = 0;
            }
            
            currentTimeline = timelines[currentTimelineIndex];
            fossilsFound = 0;
            initDigSites();
            initBackgroundElements();
            updateUI();
        }
        
        function drawBackground() {
            // Gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, currentTimeline.bgColor[0]);
            gradient.addColorStop(1, currentTimeline.bgColor[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw ground layers
            ctx.fillStyle = 'rgba(101, 67, 33, 0.5)';
            ctx.fillRect(0, canvas.height * 0.7, canvas.width, canvas.height * 0.3);
            
            ctx.fillStyle = 'rgba(61, 37, 13, 0.3)';
            ctx.fillRect(0, canvas.height * 0.85, canvas.width, canvas.height * 0.15);
        }
        
        function performScan(x, y) {
            // Start scanning
            isScanning = true;
            scanPulse = 0;
            
            // Check which dig sites are in scan radius
            digSites.forEach(site => {
                const dist = Math.sqrt((x - site.x) ** 2 + (y - site.y) ** 2);
                if (dist <= scanRadius && !site.discovered) {
                    site.scanned = true;
                }
            });
        }
        
        function handleDig(x, y) {
            // Create dig particles
            for (let i = 0; i < 15; i++) {
                particles.push(new Particle(x, y));
            }
            
            // Check if clicked on a dig site
            for (let i = digSites.length - 1; i >= 0; i--) {
                const site = digSites[i];
                const dist = Math.sqrt((x - site.x) ** 2 + (y - site.y) ** 2);
                
                // Can only dig if scanned
                if (dist < site.size && !site.discovered && site.scanned) {
                    const found = site.dig();
                    
                    if (found) {
                        // Found a fossil!
                        score += site.fossil.points;
                        fossilsFound++;
                        showNotification(site.fossil);
                        
                        // Create celebration particles
                        for (let j = 0; j < 30; j++) {
                            particles.push(new Particle(site.x, site.y));
                        }
                        
                        // Remove the dig site
                        digSites.splice(i, 1);
                        
                        // Check if timeline is complete
                        if (fossilsFound >= currentTimeline.required) {
                            setTimeout(() => {
                                alert(`üéä Timeline Complete!\n\nYou've mastered the ${currentTimeline.name}!\nMoving to the next era...`);
                                nextTimeline();
                            }, 1000);
                        }
                        
                        updateUI();
                    }
                    break;
                }
            }
        }
        
        function gameLoop() {
            animationTime++;
            
            drawBackground();
            
            // Update and draw background elements
            bgElements.forEach(element => {
                element.update(animationTime);
                element.draw(animationTime);
            });
            
            // Draw scanning effect
            if (isScanning) {
                scanPulse += 0.1;
                
                const scanX = isMobile ? touchX : mouseX;
                const scanY = isMobile ? touchY : mouseY;
                
                // Multiple expanding scan rings
                for (let i = 0; i < 3; i++) {
                    const currentRadius = scanRadius + Math.sin(scanPulse + i) * 20;
                    const opacity = (0.8 - (scanPulse / 10)) * (1 - i * 0.3);
                    
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = `rgba(0, 255, 255, ${opacity})`;
                    ctx.strokeStyle = `rgba(0, 255, 255, ${opacity})`;
                    ctx.lineWidth = 4 - i;
                    ctx.beginPath();
                    ctx.arc(scanX, scanY, currentRadius - i * 10, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.shadowBlur = 0;
                }
                
                // Draw inner glow with multiple gradients
                const gradient1 = ctx.createRadialGradient(scanX, scanY, 0, scanX, scanY, scanRadius * 0.5);
                gradient1.addColorStop(0, 'rgba(0, 255, 255, 0.3)');
                gradient1.addColorStop(1, 'rgba(0, 255, 255, 0.1)');
                ctx.fillStyle = gradient1;
                ctx.beginPath();
                ctx.arc(scanX, scanY, scanRadius * 0.5, 0, Math.PI * 2);
                ctx.fill();
                
                const gradient2 = ctx.createRadialGradient(scanX, scanY, scanRadius * 0.5, scanX, scanY, scanRadius);
                gradient2.addColorStop(0, 'rgba(0, 255, 255, 0.1)');
                gradient2.addColorStop(1, 'rgba(0, 255, 255, 0)');
                ctx.fillStyle = gradient2;
                ctx.beginPath();
                ctx.arc(scanX, scanY, scanRadius, 0, Math.PI * 2);
                ctx.fill();
                
                // Scan grid effect
                const gridSize = 20;
                ctx.strokeStyle = `rgba(0, 255, 255, ${0.2 - (scanPulse / 30)})`;
                ctx.lineWidth = 1;
                for (let x = scanX - scanRadius; x < scanX + scanRadius; x += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(x, scanY - scanRadius);
                    ctx.lineTo(x, scanY + scanRadius);
                    ctx.stroke();
                }
                for (let y = scanY - scanRadius; y < scanY + scanRadius; y += gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(scanX - scanRadius, y);
                    ctx.lineTo(scanX + scanRadius, y);
                    ctx.stroke();
                }
                
                // Stop scanning animation after a bit
                if (scanPulse > 6) {
                    isScanning = false;
                    scanPulse = 0;
                }
            }
            
            // Update and draw particles
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            
            // Draw dig sites
            digSites.forEach(site => site.draw());
            
            requestAnimationFrame(gameLoop);
        }
        
        // Desktop mouse controls
        if (!isMobile) {
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                handleDig(x, y);
            });
            
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });
            
            window.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'e' && !isScanning) {
                    performScan(mouseX, mouseY);
                }
            });
        }
        
        // Mobile touch controls
        if (isMobile) {
            // Touch events for digging
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                touchX = touch.clientX - rect.left;
                touchY = touch.clientY - rect.top;
                handleDig(touchX, touchY);
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                touchX = touch.clientX - rect.left;
                touchY = touch.clientY - rect.top;
            });
            
            // Scan button
            const scanBtn = document.getElementById('scanBtn');
            if (scanBtn) {
                scanBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!isScanning) {
                        performScan(canvas.width / 2, canvas.height / 2);
                    }
                });
            }
            
            // Help button
            const helpBtn = document.getElementById('helpBtn');
            const helpModal = document.getElementById('helpModal');
            const closeHelp = document.getElementById('closeHelp');
            
            if (helpBtn) {
                helpBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    helpModal.classList.remove('hidden');
                });
            }
            
            if (closeHelp) {
                closeHelp.addEventListener('click', () => {
                    helpModal.classList.add('hidden');
                });
            }
            
            // Info toggle button
            const infoToggle = document.getElementById('infoToggle');
            const mobileInfo = document.getElementById('mobileInfo');
            
            if (infoToggle) {
                infoToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    mobileInfo.classList.toggle('hidden');
                });
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            // Reinitialize dig sites with new positions if needed
            if (digSites.length > 0) {
                // Keep existing progress but adjust for new screen size
                const scaleX = canvas.width / window.innerWidth;
                const scaleY = canvas.height / window.innerHeight;
                digSites.forEach(site => {
                    site.x *= scaleX;
                    site.y *= scaleY;
                });
            }
        });
        
        // Prevent scrolling on iOS
        document.addEventListener('touchmove', (e) => {
            if (e.target === canvas) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Hide loading screen after everything is ready
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.transition = 'opacity 0.5s';
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }, 1000);
        });
        
        // Initialize game
        initDigSites();
        initBackgroundElements();
        updateUI();
        gameLoop();
        
        // Hide loading screen
        setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.transition = 'opacity 0.5s';
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
        }, 500);
    </script>
</body>
</html>
